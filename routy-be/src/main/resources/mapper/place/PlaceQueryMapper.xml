<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.c4.routy.domain.place.mapper.PlaceQueryMapper">

    <!-- 장소 추가 -->
    <insert id="insertPlace" parameterType="com.c4.routy.domain.place.dto.PlaceCreateRequestDTO">
        INSERT INTO TBL_TRAVEL (
            travel_order,
            estimated_travel_time,
            title,
            latitude,
            longitude,
            category_code,
            category_group_name,
            address_name,
            place_url,
            description,
            image_path,
            run_time,
            duration_id
        )
        VALUES (
                   #{travelOrder},
                   #{estimatedTravelTime},
                   #{title},
                   #{latitude},
                   #{longitude},
                   #{categoryCode},
                   #{categoryGroupName},
                   #{addressName},
                   #{placeUrl},
                   #{description},
                   #{imagePath},
                   #{runTime},
                   (SELECT duration_id FROM TBL_DURATION WHERE plan_id = #{planId} LIMIT 1)
            )
    </insert>

    <!-- 일정(planId) 기준으로 모든 장소 조회 -->
    <select id="findPlacesByPlanId" parameterType="int"
            resultType="com.c4.routy.domain.place.entity.PlaceEntity">
        SELECT
            t.travel_id,
            t.travel_order,
            t.estimated_travel_time,
            t.title,
            t.latitude,
            t.longitude,
            t.category_code,
            t.category_group_name,
            t.address_name,
            t.place_url,
            t.description,
            t.image_path,
            t.run_time,
            t.duration_id
        FROM TBL_TRAVEL t
                 JOIN TBL_DURATION d ON t.duration_id = d.duration_id
        WHERE d.plan_id = #{planId}
        ORDER BY t.travel_order ASC
    </select>

</mapper>
